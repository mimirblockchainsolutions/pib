# pib

`pib` is a command-line utility for quickly configuring and deploying small Ethereum-style
Proof of Authority blockchains.

**Note**: This project is experimental and subject to breaking changes. Feel free to get
in touch with ideas for features or improvements that would make it more useful for you.


## About

The name `pib` is a recursive acronym for "pib isn't basil" (the [emperor](https://en.wikipedia.org/wiki/Basil_I),
not the [plant](https://en.wikipedia.org/wiki/Basil)).

`pib` facilitates a fast design-build-test cycle for purpose-specific blockchain deployments
by managing details such as account-generation, node configuration, and contract deployment.

Say, for example, that we have a contract named `FriendsList` which expects the constructor
arguments `(address owner, address[] friends)`.  An example configuration might look like
this:

```toml
[[contract]]
name = "FriendsList"
addr = "0x00000000000000000000000000000000000a11ce"
args = [
    "account-addr::alice",
    "match-addrs::alice-friend",
]
```

The above configuration tells `pib` to find and compile the contract named `FriendsList`, and to deploy
it at the address `0x00000000000000000000000000000000000a11ce` with the address of the account
named `alice` as the first constructor argument, and an array of all addresses tagged with `alice-friend`
as the second constructor argument.


## Installation

To get the most out of `pib`, make sure you have recent version of `docker`, `docker-compose`,
and `solc` installed.  Building `pib` will also require `rustc` and `cargo` (latest stable).

Once you've met the above requirements, run `cargo install --path .` from the repository root.

You can run `pib --help` to confirm that the install was successful and see a list of the
available commands.


## Usage

Run `pib new <project-name>` to initialize a new project directory with reasonable default options:

```
$ pib new my-project
$ cd my-project
$ tree
.
├── config
│   ├── contracts
│   │   └── EchoContract.sol
│   └── templates
│       ├── authority-config.toml
│       ├── chain.json
│       ├── Dockerfile
│       ├── init.sh
│       └── interface-config.toml
├── include
│   └── example
│       └── include.md
└── pib.toml

5 directories, 8 files
```

The only required file is the `pib.toml` which describes the core project configuration.

The `config/contracts` directory contains contract source-code which is used to build contracts
specified in the `pib.toml`.  The default values of various files generated by `pib` may be
overridden by changing the contents of `config/templates` (e.g. the `chain.json` file which
`pib` uses as the basis for generating a [chain specification](https://wiki.parity.io/Chain-specification)
can be modified to supply custom values for `gasLimit` or `networkID`).  The `include` directory
allows the user to replicate arbitrary files to one or more nodes.  By default, new projects
are generated with examples demonstrating basic contract deployment and file replication.

Projects may be built with the `build` subcommand, and launched with `docker-compose`:

```
$ pib build
...
$ cd output
$ sudo docker-compose up --build
... 
```

## Development

Current iteration:

- [x] Separate setup and build processes into context object and module trait
- [x] Export cli option structs from main crate
- [x] Finish implementing arbitrary (and recursive) `include` arguments
- [ ] Clarify `ConfigModule`'s operational contract
  - Practical to require idempotence?
- [ ] Support "export" operations for `internal` entities
  - Should `export` include contracts/templates/etc?
- [ ] Add config module for network topology contract
- [ ] Add config module for parity Secret Store functionality
- [ ] Add `dry-run` cli option for builds
  - Mostly useful for ensuring that all `ConfigModule` ops succeed
- [ ] Raise error on duplicates for named entities (e.g. nodes)
- [ ] Raise error on duplicate file insertions
- [x] Build/rebuild contracts by default (add cli option to override)
- [ ] Add cli option to export contract ABIs
- [ ] Allow toggling of active modules from command-line
- [ ] Use `temfile::TempDir` for contract compilation & tests
- [ ] Improve node IP address handling
  - Non-empty list instead of one-to-one?
  - One primary and zero or more alternate?

